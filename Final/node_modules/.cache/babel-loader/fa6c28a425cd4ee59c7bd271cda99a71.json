{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\DELL\\\\Desktop\\\\BLOCKChain-SoftwareEngg\\\\week11\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\DELL\\\\Desktop\\\\BLOCKChain-SoftwareEngg\\\\week11\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"C:\\\\Users\\\\DELL\\\\Desktop\\\\BLOCKChain-SoftwareEngg\\\\week11\\\\src\\\\components\\\\App.js\";\nimport React, { Component } from 'react';\nimport Web3 from 'web3';\nimport logo from '../logo.png';\nimport './App.css';\nimport Ethbay from '../abis/Ethbay';\nimport Addressbar from './Addressbar';\nimport Main from './Main';\n\nclass App extends Component {\n  constructor(...args) {\n    var _this;\n\n    super(...args);\n    _this = this;\n    this.state = {\n      account: '',\n      totalNumber: 0,\n      items: [],\n      loading: true\n    };\n\n    this.createItem = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(itemName, itemPrice) {\n        var gasAmount;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _context.next = 3;\n              return _this.state.deployedEthbay.methods.createItem(itemName, itemPrice).estimateGas({\n                from: _this.state.account\n              });\n\n            case 3:\n              gasAmount = _context.sent;\n\n              _this.state.deployedEthbay.methods.createItem(itemName, itemPrice).send({\n                from: _this.state.account,\n                gas: gasAmount\n              }).once('receipt', receipt => {\n                _this.setState({\n                  loading: false\n                });\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    this.buyItem = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(itemId, sellingPrice) {\n        var gasAmount;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _context2.next = 3;\n              return _this.state.deployedEthbay.methods.buyItem(itemId).estimateGas({\n                from: _this.state.account,\n                value: sellingPrice\n              });\n\n            case 3:\n              gasAmount = _context2.sent;\n\n              _this.state.deployedEthbay.methods.buyItem(itemId).send({\n                from: _this.state.account,\n                value: sellingPrice,\n                gas: gasAmount\n              }).once('receipt', receipt => {\n                _this.setState({\n                  loading: false\n                });\n              });\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3, _x4) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }\n\n  componentDidMount() {\n    var _this2 = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _this2.getWeb3Provider();\n\n          case 2:\n            _context3.next = 4;\n            return _this2.connectToBlockchain();\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }, _callee3);\n    }))();\n  }\n\n  getWeb3Provider() {\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!window.ethereum) {\n              _context4.next = 6;\n              break;\n            }\n\n            window.web3 = new Web3(window.ethereum);\n            _context4.next = 4;\n            return window.ethereum.enable();\n\n          case 4:\n            _context4.next = 7;\n            break;\n\n          case 6:\n            if (window.web3) {\n              window.web3 = new Web3(window.web3.currentProvider);\n            } else {\n              window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');\n            }\n\n          case 7:\n          case \"end\":\n            return _context4.stop();\n        }\n      }, _callee4);\n    }))();\n  }\n\n  connectToBlockchain() {\n    var _this3 = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var web3, accounts, networkId, networkData, deployedEthbay, totalNumber, i, item;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) switch (_context5.prev = _context5.next) {\n          case 0:\n            web3 = window.web3;\n            _context5.next = 3;\n            return web3.eth.getAccounts();\n\n          case 3:\n            accounts = _context5.sent;\n\n            _this3.setState({\n              account: accounts[0]\n            });\n\n            _context5.next = 7;\n            return web3.eth.net.getId();\n\n          case 7:\n            networkId = _context5.sent;\n            networkData = Ethbay.networks[networkId];\n\n            if (!networkData) {\n              _context5.next = 30;\n              break;\n            }\n\n            deployedEthbay = new web3.eth.Contract(Ethbay.abi, networkData.address);\n\n            _this3.setState({\n              deployedEthbay: deployedEthbay\n            });\n\n            _context5.next = 14;\n            return deployedEthbay.methods.totalNumber().call();\n\n          case 14:\n            totalNumber = _context5.sent;\n            console.log(totalNumber);\n\n            _this3.setState({\n              totalNumber\n            });\n\n            i = 1;\n\n          case 18:\n            if (!(i <= totalNumber)) {\n              _context5.next = 26;\n              break;\n            }\n\n            _context5.next = 21;\n            return deployedEthbay.methods.items(i).call();\n\n          case 21:\n            item = _context5.sent;\n\n            _this3.setState({\n              items: [..._this3.state.items, item]\n            });\n\n          case 23:\n            i++;\n            _context5.next = 18;\n            break;\n\n          case 26:\n            _this3.setState({\n              loading: false\n            });\n\n            console.log(_this3.state.items);\n            _context5.next = 31;\n            break;\n\n          case 30:\n            window.alert('Ethbay contract is not found in your blockchain.');\n\n          case 31:\n          case \"end\":\n            return _context5.stop();\n        }\n      }, _callee5);\n    }))();\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, React.createElement(Addressbar, {\n      account: this.state.account,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"container-fluid mt-5\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, React.createElement(\"main\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, this.state.loading ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: \"text-center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, \"Loading ...\")) : React.createElement(Main, {\n      items: this.state.items,\n      createItem: this.createItem,\n      buyItem: this.buyItem,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    })))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["C:/Users/DELL/Desktop/BLOCKChain-SoftwareEngg/week11/src/components/App.js"],"names":["React","Component","Web3","logo","Ethbay","Addressbar","Main","App","state","account","totalNumber","items","loading","createItem","itemName","itemPrice","setState","deployedEthbay","methods","estimateGas","from","gasAmount","send","gas","once","receipt","buyItem","itemId","sellingPrice","value","componentDidMount","getWeb3Provider","connectToBlockchain","window","ethereum","web3","enable","currentProvider","alert","eth","getAccounts","accounts","net","getId","networkId","networkData","networks","Contract","abi","address","call","console","log","i","item","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from 'web3';\nimport logo from '../logo.png';\nimport './App.css';\nimport Ethbay from '../abis/Ethbay'\nimport Addressbar from './Addressbar'\nimport Main from './Main'\n\nclass App extends Component {\n  state = {\n    account: '',\n    totalNumber: 0,\n    items: [],\n    loading: true\n  }\n\n  async componentDidMount(){\n    await this.getWeb3Provider();\n    await this.connectToBlockchain();\n  }\n  \n  async getWeb3Provider(){\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum);\n      await window.ethereum.enable();\n    }\n    else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider);\n    }\n    else {\n        window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n  }\n\n  async connectToBlockchain(){\n    const web3 = window.web3;\n    const accounts = await web3.eth.getAccounts();\n    this.setState({account: accounts[0]})\n    const networkId = await web3.eth.net.getId()\n    const networkData = Ethbay.networks[networkId];\n    if(networkData) {\n      const deployedEthbay = new web3.eth.Contract(Ethbay.abi, networkData.address);\n      this.setState({deployedEthbay: deployedEthbay});\n      const totalNumber = await deployedEthbay.methods.totalNumber().call();\n      console.log(totalNumber);\n      this.setState({totalNumber})\n      for (var i = 1;i<= totalNumber;i++) {\n        const item = await deployedEthbay.methods.items(i).call();\n        this.setState({\n          items:[...this.state.items, item]\n        });\n      }\n      this.setState({loading: false})\n      console.log(this.state.items)\n    } else {\n      window.alert('Ethbay contract is not found in your blockchain.')\n    }\n  \n  }\n\n \n  createItem = async (itemName, itemPrice) => {\n    this.setState ({loading: true})\n    const gasAmount = await this.state.deployedEthbay.methods.createItem(itemName, itemPrice).estimateGas({from: this.state.account})\n    this.state.deployedEthbay.methods.createItem(itemName, itemPrice).send({from: this.state.account, gas: gasAmount})\n    .once('receipt', (receipt)=> {\n      this.setState({loading: false});\n    })\n  }\n\n  buyItem = async (itemId, sellingPrice) => {\n    this.setState ({loading: true})\n    const gasAmount = await this.state.deployedEthbay.methods.buyItem(itemId).estimateGas({from: this.state.account, value: sellingPrice})\n    this.state.deployedEthbay.methods.buyItem(itemId).send({from: this.state.account, value: sellingPrice, gas: gasAmount })\n    .once('receipt', (receipt)=> {\n      this.setState({loading: false});\n    })\n  }\n  \n  render() {\n    return (\n      <div>\n        <Addressbar account={this.state.account}/>\n        <div className=\"container-fluid mt-5\">\n          <div className=\"row\">\n            <main>\n              { this.state.loading \n                ? \n                  <div><p className=\"text-center\">Loading ...</p></div> \n                : \n                  <Main items = {this.state.items} \n                        createItem = {this.createItem}\n                        buyItem = {this.buyItem}\n                  />}\n            </main>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}